<h2 class="m-3">Portfolio</h2>

<div 

  class="m-4 p-4 border rounded shadow-sm text-white"
  [ngClass]="{
    'bg-success border-success': totalProfitLoss > 0,
    'bg-danger border-danger': totalProfitLoss < 0,
    'bg-secondary border-secondary': isNeutral()
  }"
  style="transition: background-color 0.5s ease, border-color 0.5s ease;"
  *ngIf="holdings.length > 0"
>
  <h4 class="mb-3 fw-bold">
    Total Value: ₹{{ totalValue | number:'1.2-2' }}
  </h4>

  <div class="d-flex justify-content-between mb-2">
    <span><strong>Total Invested:</strong></span>
    <span>₹{{ totalInvested | number:'1.2-2' }}</span>
  </div>

  <div class="d-flex justify-content-between mb-2">
    <span><strong>Total Profit/Loss:</strong></span>
    <span>
      ₹{{ totalProfitLoss | number:'1.2-2' }}
    </span>
  </div>

  <div class="d-flex justify-content-between">
    <span><strong>Overall Change:</strong></span>
    <span>
      {{ profitLossPercent | number:'1.2-2' }}%
    </span>
  </div>
</div>


<!-- Holdings Table Section -->
<div class="m-4" *ngIf="holdings.length > 0">
  <h2 class="mb-3">Holdings (My Wealth)</h2>

  <!-- Records per page -->
  <div class="d-flex justify-content-end mb-2 align-items-center">
    <label class="me-2 mb-0">Records per page:</label>
    <select class="form-control w-auto" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
      <option [value]="5">5</option>
      <option [value]="10">10</option>
      <option [value]="20">20</option>
    </select>
  </div>

  <!-- Responsive Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-light text-center">
        <tr>
          <th>#</th>
          <th>Stock</th>
          <th>Symbol</th>
          <th>Sector</th>
          <th>Quantity</th>
          <th>Avg. Purchase Price</th>
          <th>Current Price</th>
          <th>Profit / Loss</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let holding of holdings; let i = index" >
          <td class="text-center">{{ (currentPage * pageSize) + i + 1 }}</td>
          <td>
            <img [src]="holding.stock.imageUrl"
                 [alt]="holding.stock.name"
                 width="30"
                 height="30"
                 class="me-2 rounded" />
            {{ holding.stock.name }}
          </td>
          <td class="text-center">{{ holding.stock.symbol }}</td>
          <td>{{ holding.stock.sector }}</td>
          <td class="text-center">{{ holding.quantity }}</td>
          <td class="text-end">{{ holding.avgPrice | number:'1.2-2' }}</td>
          <td class="text-end">{{ holding.stock.currentPrice | number:'1.2-2' }}</td>
          <td class="text-end">
            <span *ngIf="holding.profitLossAmount != null && holding.profitLossPercent != null"
                  [ngClass]="{
                    'text-success': holding.profitLossAmount > 0,
                    'text-danger': holding.profitLossAmount < 0,
                    'text-muted': holding.profitLossAmount === 0
                  }">
              {{ holding.profitLossAmount | number:'1.2-2' }} 
              ({{ holding.profitLossPercent | number:'1.2-2' }}%)
            </span>
          </td>
          <td class="text-center">
            <button class="btn btn-sm btn-danger" (click)="goToSell(holding)">Sell</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Show message if there are no holdings -->
<div *ngIf="holdings.length === 0" class="text-center mt-4">
  <p>No holdings to display.</p>
  <h6>Please visit market to explore stocks!</h6>
</div>

<!-- Pagination Controls -->
<div *ngIf="totalPages > 1" class="mt-4">
  <nav>
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="onPageChange(currentPage - 1)">Previous</button>
      </li>

      <li class="page-item disabled">
        <span class="page-link">
          Page {{ currentPage + 1 }} of {{ totalPages }}
        </span>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
        <button class="page-link" (click)="onPageChange(currentPage + 1)">Next</button>
      </li>
    </ul>
  </nav>
</div>


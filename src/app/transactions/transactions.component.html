<div class="container mt-4 mb-5">
  <h3 class="mb-4">Portfolio Transactions</h3>

   <!-- Toggle Buttons -->
  <div class="mb-3 d-flex gap-2">
    <button class="btn" 
            [class.btn-primary]="selectedType === 'all'" 
            (click)="selectedType = 'all'">All</button>
    <button class="btn" 
            [class.btn-success]="selectedType === 'buy'" 
            (click)="selectedType = 'buy'">Buy</button>
    <button class="btn" 
            [class.btn-danger]="selectedType === 'sell'" 
            (click)="selectedType = 'sell'">Sell</button>
  </div>

  <!-- Search Input -->
  <div class="mb-4">
    <input
      type="text"
      class="form-control"
      placeholder="Search by name, symbol, or type"
      [(ngModel)]="searchQuery"
    />
  </div>


  <div *ngIf="filteredAndPaginatedTransactions.length > 0; else noTransactions">
    <div
      *ngFor="let txn of filteredAndPaginatedTransactions"
      class="card mb-3 shadow-sm"
      [ngClass]="{ 'border-primary': selectedTransaction === txn }"
      (click)="toggleDetails(txn)"
      style="cursor: pointer;"
    >
      <div class="card-body">
        <!-- Sum  mary Row -->
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <img [src]="txn.stock?.imageUrl" alt="{{ txn.name }} Logo" style="object-fit: contain;" width="50" height="50" class="me-2 rounded border">

            <h5 class="card-title mb-1">{{ txn.stock?.name }} ({{ txn.stock?.symbol }})</h5>
            <p class="text-muted mb-0">
              <strong>Sector:</strong> {{ txn.stock?.sector }}
            </p>
            <p class="text-muted mb-0">
              <strong>Transaction Type:</strong> {{ txn.transactionType }} 
            </p>
            <p class="text-muted mb-0">
              <strong>Quantity:</strong> {{ txn.quantity }}
            </p>
            <p class="text-muted mb-0">
              <strong>Total Amount:</strong> ₹{{ txn.totalAmount | number: '1.2-2' }}
            </p>
            <p class="text-muted mb-0">
              <strong>Date & Time:</strong> {{ txn.timestamp | date: 'MMM d, y, h:mm a' }}
            </p>
          </div>
        </div>

        <!-- Expanded Details -->
        <div *ngIf="selectedTransaction === txn" class="mt-3">
          <div class="row">
            <hr>
            <div class="col-12 text-muted"><strong>Price/Unit:</strong> ₹{{ txn.pricePerUnit }}</div>
            <div class="col-12 text-muted"><strong>Subtotal (Quantity x Price/Unit):</strong> ₹{{ txn.subTotal }}</div>

             <div class="col-12 mt-3 text-muted">
              <strong>Total Amount: (SubTotal + Charges)</strong><br />
              ₹{{ txn.subTotal }} + ₹{{ txn.brokerage }} (Brokerage)+ ₹{{ txn.exchangeTxnCharges }} (Exchange Charges)
              <span *ngIf="txn.transactionType === 'BUY'"> + ₹{{ txn.stampDuty }} (Stamp Duty)</span>
              <span *ngIf="txn.transactionType === 'SELL'" class="text-danger"> + ₹{{ txn.stampDuty }} (Stamp Duty excluded)</span>
              + ₹{{ txn.ipft }} (IPFT) + ₹{{ txn.sebiCharges }} (SEBI Charges) + ₹{{ txn.stt }} (STT)+ ₹{{ txn.gst }} (GST) =
              <strong> ₹{{ txn.totalAmount }}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Transactions -->
  <ng-template #noTransactions>
    <p class="text-center text-muted">No portfolio transactions found.</p>
  </ng-template>

  <nav *ngIf="totalPages > 1" class="d-flex justify-content-center mt-4">
    <ul class="pagination">
      
      <!-- Previous button -->
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="currentPage = currentPage - 1" 
                [disabled]="currentPage === 0">
          Previous
        </button>
      </li>

      <!-- Current page (1-based index) -->
      <li class="page-item active">
        <span class="page-link">
          {{ currentPage + 1 }}
        </span>
      </li>

      <!-- Next button -->
      <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
        <button class="page-link" (click)="currentPage = currentPage + 1" 
                [disabled]="currentPage >= totalPages - 1">
          Next
        </button>
      </li>

    </ul>
  </nav>

</div>
